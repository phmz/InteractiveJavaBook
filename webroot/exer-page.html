<html>
 <head>
  <script src="//code.jquery.com/jquery-1.11.3.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
  <script src="http://cdn.sockjs.org/sockjs-0.3.4.min.js"></script>
<script src='vertx-eventbus.js'></script>
  
  <script>
   $(document).ready(function() {
     var element = $("#title");
     
     var getUrlParameter = function getUrlParameter(sParam) {
     	var sPageURL = decodeURIComponent(window.location.search.substring(1)),
     	   sURLVariables = sPageURL.split('&'),
        	sParameterName,
        	i;

     for (i = 0; i < sURLVariables.length; i++) {
        sParameterName = sURLVariables[i].split('=');

        if (sParameterName[0] === sParam) {
            return sParameterName[1] === undefined ? true : sParameterName[1];
        }
      }
	 };
	 id = getUrlParameter('id');
     $.get('/api/exercises/'.concat(id), function(page) {

	   element.prepend('<p>' + page + '</p>');
      
       $("body").on("input", "#answer", function() {
         alert("change !"); 
       });
     });
     updatePage(id);
   }
   var eb = new EventBus('http://localhost:8080/eventbus');

	eb.onopen = function() {

  	// set a handler to receive a message
  	eb.registerHandler('/api/register/'.concat(id), function(message) {
    	console.log('received a message: ' + JSON.stringify(message);
  	});

  	// send a message
  	eb.send('some-address', {name: 'tim', age: 587});

	}
   
   );
   
   function updatePage(id){
   		$.post('/api/register/'.concat(id), function(data){
     		$("#title">"p").remove();
     		$("#title").prepend('<p>' + data + '</p>');
     		updatePage(id);
     	});
   }
  </script>
 </head>
 <body>
  <div id="title" class="container" role="main">
  </div>
  <div id="exercise">
	  <textarea id="answer" rows=10>Your answser !</textarea>
	  <button class='btn btn-primary btn-sm product-edit'>
	  <span class='glyphicon glyphicon-pencil'></span>
	  </button>
  </div>

 </body>
</html>
